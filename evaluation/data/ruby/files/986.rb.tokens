class ParticipationCounter < ActiveRecord :: Migration def up add_column <str> , <str> , <str> , <str> : false , <str> : <int> posts_count = Post . select ( <str> ) . where ( <str> ) . where ( <str> ) . to_sql likes_count = Like . select ( <str> ) . where ( <str> ) . where ( <str> ) . to_sql comments_count = Comment . select ( <str> ) . where ( <str> ) . where ( <str> ) . to_sql polls_count = PollParticipation . select ( <str> ) . where ( <str> ) . joins ( <str> ) . where ( <str> ) . to_sql Participation . update_all ( <str> posts_count <str> likes_count <str> comments_count <str> polls_count <str> ) Participation . where ( <str> : <int> ) . delete_all end def down remove_column <str> , <str> end end 
