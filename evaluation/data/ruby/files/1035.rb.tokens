class Couchdb < Formula desc <str> homepage <str> revision <int> stable do url <str> sha256 <str> patch <str> end bottle do cellar <str> sha256 <str> = > <str> sha256 <str> = > <str> sha256 <str> = > <str> end head do url <str> depends_on <str> = > <str> depends_on <str> = > <str> depends_on <str> = > <str> depends_on <str> = > <str> depends_on <str> = > <str> depends_on <str> = > <str> end depends_on <str> depends_on <str> depends_on <str> depends_on <str> if MacOS . version < = <str> def install inreplace <str> do | s | s . gsub! <str> , <str> s . gsub! <str> , pkg_version end if build . devel? || build . head? touch <str> system <str> end system <str> , <str> prefix <str> , <str> var <str> , <str> etc <str> , <str> , <str> HOMEBREW_PREFIX <str> , <str> HOMEBREW_PREFIX <str> , <str> HOMEBREW_PREFIX <str> system <str> system <str> , <str> ( prefix / <str> ) . delete ( lib / <str> ) . chmod <oct> ( var / <str> ) . mkpath ( var / <str> ) . mkpath ( var / <str> ) . mkpath end def post_install if ( etc / <str> ) . exist? mv etc / <str> , etc / <str> mv etc / <str> , etc / <str> end end plist_options <str> = > <str> def plist ; <<- <str> EOS <str> . undent <str> EOS end def caveats ; <<- <str> EOS <str> . undent <str> EOS end test do system <str> bin <str> , <str> ( testpath / <str> ) . mkpath ( testpath / <str> ) . mkpath ( testpath / <str> ) . mkpath cp_r etc / <str> , testpath inreplace <str> testpath <str> , <str> , testpath / <str> pid = fork do exec <str> bin <str> testpath <str> end sleep <int> begin assert_match <str> , shell_output ( <str> ) ensure Process . kill ( <str> , pid ) Process . wait ( pid ) end end end 
