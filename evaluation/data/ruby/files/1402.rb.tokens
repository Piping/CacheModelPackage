class IncomingReferer < ActiveRecord :: Base belongs_to <str> def self . add! ( opts ) domain_id = opts [ <str> ] domain_id || = opts [ <str> ] . id path = opts [ <str> ] current = find_by ( <str> : path , <str> : domain_id ) return current if current begin current = create! ( <str> : path , <str> : domain_id ) rescue ActiveRecord :: RecordNotUnique end current || find_by ( <str> : path , <str> : domain_id ) end end 
