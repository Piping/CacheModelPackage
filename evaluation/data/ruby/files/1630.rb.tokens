module XapianQueries def get_request_variety_from_params ( params ) query = <str> sortby = <str> varieties = [ ] if params [ <str> ] && ! ( query =~ <str> ) if params [ <str> ] . include? <str> varieties -= [ <str> , <str> , <str> , <str> ] varieties << [ <str> , <str> ] end if params [ <str> ] . include? <str> varieties << [ <str> ] end if params [ <str> ] . include? <str> varieties << [ <str> ] end end if ! varieties . empty? query = <str> varieties . join ( <str> ) <str> end return query end def get_status_from_params ( params ) query = <str> if params [ <str> ] statuses = [ ] if params [ <str> ] . class == String params [ <str> ] = [ params [ <str> ] ] end if params [ <str> ] . include? ( <str> ) || params [ <str> ] . include? ( <str> ) query += <str> end if params [ <str> ] . include? <str> statuses << [ <str> , <str> ] end if params [ <str> ] . include? <str> statuses << [ <str> , <str> ] end if params [ <str> ] . include? <str> statuses << [ <str> , <str> , <str> , <str> , <str> , <str> , <str> ] end if params [ <str> ] . include? <str> statuses << [ <str> ] end if params [ <str> ] . include? <str> statuses << [ <str> , <str> , <str> , <str> ] end if params [ <str> ] . include? <str> statuses << [ <str> ] end if ! statuses . empty? query = <str> statuses . join ( <str> ) <str> end end return query end def get_date_range_from_params ( params ) query = <str> if params . has_key? ( <str> ) && ! params . has_key? ( <str> ) params [ <str> ] = Time . now . strftime ( <str> ) query += <str> params [ <str> ] <str> params [ <str> ] <str> elsif ! params . has_key? ( <str> ) && params . has_key? ( <str> ) params [ <str> ] = <str> end if params . has_key? ( <str> ) query = <str> params [ <str> ] <str> params [ <str> ] <str> end return query end def make_query_from_params ( params ) query = params [ <str> ] || <str> query += get_date_range_from_params ( params ) query += get_request_variety_from_params ( params ) query += get_status_from_params ( params ) query end end 
