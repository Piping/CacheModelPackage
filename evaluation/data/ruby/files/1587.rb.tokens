class MessageBusDiags @host_info = { } def self . my_id @my_id || = <str> Process . pid <str> end def self . seen_host ( name ) @host_info [ name ] = DateTime . now end def self . establish_peer_names MessageBus . publish <str> , { <str> : <str> my_id <str> } end def self . seen_hosts @host_info end unless @subscribed MessageBus . subscribe <str> my_id <str> do | msg | MessageBusDiags . seen_host ( msg . data ) end MessageBus . subscribe <str> do | msg | MessageBus . publish msg . data [ <str> ] , MessageBusDiags . my_id end @subscribed = true end end 
