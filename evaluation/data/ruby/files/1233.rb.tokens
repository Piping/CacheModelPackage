require <str> require <str> require <str> extend Puppet :: Acceptance :: TempFileUtils test_name <str> node_name = <str> SecureRandom . hex <str> auth_contents = << <str> AUTHCONF <str> <str> AUTHCONF temp_dirs = initialize_temp_dirs create_test_file master , <str> , auth_contents , { } authfile = get_test_file_path master , <str> on master , <str> authfile <str> temp_yamldir = File . join ( temp_dirs [ master . name ] , <str> ) on master , <str> temp_yamldir <str> user = puppet_user master group = puppet_group master on master , <str> user <str> group <str> temp_yamldir <str> master_opts = { <str> = > { <str> = > authfile , <str> = > temp_yamldir , } } with_puppet_running_on master , master_opts do run_agent_on ( agents [ <int> ] , <str> node_name <str> master <str> ) yamldir = on ( master , puppet ( <str> , <str> , <str> ) ) . stdout . chomp on master , puppet ( <str> , <str> , <str> , <str> , <str> , <str> , yamldir , <str> , <str> ) do assert_match ( <str> node_name <str> , stdout , <str> node_name <str> ) end end 
