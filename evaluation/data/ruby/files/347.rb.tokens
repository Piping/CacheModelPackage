class BookmarkletRenderer class << self def cached_name @cached || = Rails . root . join ( <str> , <str> , <str> ) end def source_name @source || = Rails . application . assets [ <str> ] . pathname . to_s end def body if ! File . exist? ( cached_name ) && Rails . env . production? raise <str> end compile unless Rails . env . production? @body || = File . read ( cached_name ) end def compile src = File . read ( source_name ) @body = Uglifier . compile ( src ) FileUtils . mkdir_p cached_name . dirname File . open ( cached_name , <str> ) { | f | f . write ( @body ) } end end end 
