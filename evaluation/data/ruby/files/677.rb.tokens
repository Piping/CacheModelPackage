require <str> require <str> require <str> class SuppressorTest < ActiveRecord :: TestCase def test_suppresses_create assert_no_difference - > { Notification . count } do Notification . suppress do Notification . create Notification . create! Notification . new . save Notification . new . save! end end end def test_suppresses_update user = User . create! <str> : <str> User . suppress do user . update <str> : <str> assert_equal <str> , user . reload . token user . update! <str> : <str> assert_equal <str> , user . reload . token user . token = <str> user . save assert_equal <str> , user . reload . token user . token = <str> user . save! assert_equal <str> , user . reload . token end end def test_suppresses_create_in_callback assert_difference - > { User . count } do assert_no_difference - > { Notification . count } do Notification . suppress { UserWithNotification . create! } end end end def test_resumes_saving_after_suppression_complete Notification . suppress { UserWithNotification . create! } assert_difference - > { Notification . count } do Notification . create! ( <str> : <str> ) end end def test_suppresses_validations_on_create assert_no_difference - > { Notification . count } do Notification . suppress do User . create User . create! User . new . save User . new . save! end end end end 
