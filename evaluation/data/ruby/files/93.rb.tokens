class Projects :: ArtifactsController < Projects :: ApplicationController layout <str> before_action <str> def download unless artifacts_file . file_storage? return redirect_to artifacts_file . url end unless artifacts_file . exists? return render_404 end send_file artifacts_file . path , <str> : <str> end def browse return render_404 unless build . artifacts? directory = params [ <str> ] ? <str> params [ <str> ] <str> : <str> @entry = build . artifacts_metadata_entry ( directory ) return render_404 unless @entry . exists? end def file entry = build . artifacts_metadata_entry ( params [ <str> ] ) if entry . exists? render <str> : { <str> : build . artifacts_file . path , <str> : Base64 . encode64 ( entry . path ) } else render <str> : { } , <str> : <int> end end private def build @build || = project . builds . unscoped . find_by! ( id : params [ <str> ] ) end def artifacts_file @artifacts_file || = build . artifacts_file end end 
