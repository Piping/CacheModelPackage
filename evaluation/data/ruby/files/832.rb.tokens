class RemoveSystemAvatarsFromUserAvatars < ActiveRecord :: Migration def up execute <str> skip = - <int> while skip = destroy_system_avatar_batch ( skip ) do puts <str> skip <str> end remove_column <str> , <str> remove_column <str> , <str> end def destroy_system_avatar_batch ( skip ) initial = skip Upload . where ( <str> , skip ) . order ( <str> ) . limit ( <int> ) . each do | upload | skip = upload . id begin upload . destroy rescue Rails . logger . warn <str> upload . id <str> end end skip == initial ? nil : skip rescue Rails . logger . warn <str> nil end def down raise ActiveRecord :: IrreversibleMigration end end 
