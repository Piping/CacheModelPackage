test_name <str> step <str> testdir = create_tmpdir_for_user ( master , <str> ) manifest = <<- <str> MANIFEST <str> <str> MANIFEST apply_manifest_on ( master , manifest , <str> = > true ) step <str> master_opts = { <str> = > { <str> = > <str> testdir <str> } } environments = [ <str> , <str> , <str> , <str> ] with_puppet_running_on ( master , master_opts , testdir ) do agents . each do | agent | environments . each do | environment | on ( agent , puppet ( <str> , <str> master <str> environment <str> ) , <str> = > <int> ) end end end 
