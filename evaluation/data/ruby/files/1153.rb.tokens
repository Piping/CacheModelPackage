require <str> describe ResharesController , <str> = > <str> do describe <str> do let ( <str> ) { post <str> , <str> = > <str> , <str> = > @post_guid } before do @post = FactoryGirl . create ( <str> , <str> = > true ) @post_guid = @post . guid end it <str> do post_request! expect ( response ) . not_to be_success end context <str> do before do sign_in <str> , bob allow ( @controller ) . to receive ( <str> ) . and_return ( bob ) end it <str> do expect ( response ) . to be_success post_request! end it <str> do expect { post_request! } . to change ( Reshare , <str> ) . by ( <int> ) end it <str> do expect ( bob ) . to receive ( <str> ) post_request! end it <str> do expect ( bob ) . to receive ( <str> ) . with ( anything , hash_including ( <str> ) ) post_request! end context <str> do before do FactoryGirl . create ( <str> , <str> = > @post , <str> = > bob . person ) end it <str> do post_request! expect ( response . code ) . to eq ( <str> ) expect ( response . body . strip ) . to be_empty end end context <str> do before do @root = @post @post = FactoryGirl . create ( <str> , <str> = > @root , <str> = > alice . person ) end it <str> do post_request! expect ( @post . reshares . count ) . to eq ( <int> ) expect ( @root . reshares . count ) . to eq ( <int> ) end end end end end 
