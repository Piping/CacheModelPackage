require <str> require <str> require <str> options = ARGV . getopts ( <str> ) host = ARGV [ <int> ] || <str> port = options [ <str> ] || <str> cert_file = options [ <str> ] key_file = options [ <str> ] ca_path = options [ <str> ] ctx = OpenSSL :: SSL :: SSLContext . new ( ) if cert_file && key_file ctx . cert = OpenSSL :: X509 :: Certificate . new ( File :: read ( cert_file ) ) ctx . key = OpenSSL :: PKey :: RSA . new ( File :: read ( key_file ) ) end if ca_path ctx . verify_mode = OpenSSL :: SSL :: VERIFY_PEER ctx . ca_path = ca_path else $stderr . puts <str> end s = TCPSocket . new ( host , port ) ssl = OpenSSL :: SSL :: SSLSocket . new ( s , ctx ) ssl . connect p ssl . peer_cert errors = Hash . new OpenSSL :: X509 . constants . grep ( <str> ) . each do | name | errors [ OpenSSL :: X509 . const_get ( name ) ] = name end p errors [ ssl . verify_result ] ssl . sync_close = true while line = $stdin . gets ssl . write line puts ssl . gets . inspect end ssl . close 
