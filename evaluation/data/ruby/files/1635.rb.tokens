class Poll < ActiveRecord :: Base include Diaspora :: Federated :: Base include Diaspora :: Guid belongs_to <str> has_many <str> , - > { order <str> } has_many <str> xml_attr <str> xml_attr <str> , <str> = > [ PollAnswer ] delegate <str> , <str> , <str> , <str> , <str> , <str> : <str> validate <str> validates <str> , <str> : true self . include_root_in_json = false def enough_poll_answers errors . add ( <str> , I18n . t ( <str> ) ) if poll_answers . size < <int> end def as_json ( options = { } ) { <str> = > self . id , <str> = > self . status_message . id , <str> = > self . question , <str> = > self . poll_answers , <str> = > self . participation_count , } end def participation_count poll_answers . sum ( <str> ) end def already_participated? ( user ) poll_participations . where ( <str> = > user . person . id ) . present? end end 
