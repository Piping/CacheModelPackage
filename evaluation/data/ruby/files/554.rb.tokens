test_name <str> confine <str> , { <str> = > <str> } , agents confine <str> , <str> = > <str> require <str> extend Puppet :: Acceptance :: RpmUtils rpm_options = { <str> = > <str> , <str> = > <str> } teardown do step <str> agents . each do | agent | clean_rpm agent , rpm_options end end def verify_state ( hosts , pkg , state , match ) hosts . each do | agent | cmd = rpm_provider ( agent ) on agent , <str> cmd <str> do method ( match ) . call ( <str> pkg <str> , stdout ) end end end def verify_present ( hosts , pkg ) verify_state ( hosts , pkg , <str> , <str> ) end def verify_absent ( hosts , pkg ) verify_state ( hosts , pkg , <str> , <str> ) end step <str> agents . each do | agent | clean_rpm agent , rpm_options setup_rpm agent , rpm_options send_rpm agent , rpm_options end step <str> verify_absent agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_match ( <str> , <str> result . host <str> result . stdout <str> ) end step <str> verify_present agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_match ( <str> , <str> result . host <str> result . stdout <str> ) end step <str> verify_absent agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_match ( <str> , <str> result . host <str> result . stdout <str> ) end step <str> verify_present agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_match ( <str> , <str> result . host <str> result . stdout <str> ) end step <str> verify_absent agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_not_match ( <str> , <str> result . host <str> result . stdout <str> ) assert_match ( <str> , <str> result . host <str> result . stderr <str> ) end verify_absent agents , <str> step <str> verify_absent agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_not_match ( <str> , <str> result . host <str> result . stdout <str> ) assert_match ( <str> , <str> result . host <str> result . stderr <str> ) end verify_absent agents , <str> step <str> verify_absent agents , <str> apply_manifest_on ( agents , <str> ) do | result | assert_not_match ( <str> , <str> result . host <str> result . stdout <str> ) assert_match ( <str> , <str> result . host <str> result . stdout <str> ) end verify_absent agents , <str> 
