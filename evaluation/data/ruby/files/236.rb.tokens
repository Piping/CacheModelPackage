require <str> require <str> describe <str> , <str> = > Puppet . features . microsoft_windows? do UTF16_NULL = [ <int> , <int> ] def wide_string ( str ) Puppet :: Util :: Windows :: String . wide_string ( str ) end def converts_to_wide_string ( string_value ) expected = string_value . encode ( Encoding :: UTF_16LE ) expected_bytes = expected . bytes . to_a + UTF16_NULL expect ( wide_string ( string_value ) . bytes . to_a ) . to eq ( expected_bytes ) end context <str> do it <str> do expect ( wide_string ( <str> ) . encoding ) . to eq ( Encoding :: UTF_16LE ) end it <str> do expect ( wide_string ( <str> ) . valid_encoding? ) . to be_truthy end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: US_ASCII ) ) end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: UTF_8 ) ) end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: UTF_16LE ) ) end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: UTF_16BE ) ) end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: UTF_32LE ) ) end it <str> do converts_to_wide_string ( <str> . encode ( Encoding :: UTF_32BE ) ) end it <str> do expect ( wide_string ( nil ) ) . to eq ( nil ) end end end 
