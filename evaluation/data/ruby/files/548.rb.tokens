class UserVisit < ActiveRecord :: Base def self . counts_by_day_query ( start_date , end_date , group_id = nil ) result = where ( <str> , start_date . to_date , end_date . to_date ) if group_id result = result . joins ( <str> ) result = result . joins ( <str> ) result = result . where ( <str> , group_id ) end result . group ( <str> ) . order ( <str> ) end def self . by_day ( start_date , end_date , group_id = nil ) counts_by_day_query ( start_date , end_date , group_id ) . count end def self . mobile_by_day ( start_date , end_date , group_id = nil ) counts_by_day_query ( start_date , end_date , group_id ) . where ( <str> : true ) . count end def self . ensure_consistency! exec_sql << <str> SQL <str> <str> SQL end end 
