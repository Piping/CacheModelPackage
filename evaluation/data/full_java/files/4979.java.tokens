package org . elasticsearch . action . admin . cluster . repositories . put ; import org . elasticsearch . action . ActionListener ; import org . elasticsearch . action . support . ActionFilters ; import org . elasticsearch . action . support . master . TransportMasterNodeAction ; import org . elasticsearch . cluster . ClusterService ; import org . elasticsearch . cluster . ClusterState ; import org . elasticsearch . cluster . ack . ClusterStateUpdateResponse ; import org . elasticsearch . cluster . block . ClusterBlockException ; import org . elasticsearch . cluster . block . ClusterBlockLevel ; import org . elasticsearch . cluster . metadata . IndexNameExpressionResolver ; import org . elasticsearch . common . inject . Inject ; import org . elasticsearch . common . settings . Settings ; import org . elasticsearch . repositories . RepositoriesService ; import org . elasticsearch . threadpool . ThreadPool ; import org . elasticsearch . transport . TransportService ; public class TransportPutRepositoryAction extends TransportMasterNodeAction < PutRepositoryRequest , PutRepositoryResponse > { private final RepositoriesService repositoriesService ; @Inject public TransportPutRepositoryAction ( Settings settings , TransportService transportService , ClusterService clusterService , RepositoriesService repositoriesService , ThreadPool threadPool , ActionFilters actionFilters , IndexNameExpressionResolver indexNameExpressionResolver ) { super ( settings , PutRepositoryAction . NAME , transportService , clusterService , threadPool , actionFilters , indexNameExpressionResolver , PutRepositoryRequest : : new ) ; this . repositoriesService = repositoriesService ; } @Override protected String executor ( ) { return ThreadPool . Names . SAME ; } @Override protected PutRepositoryResponse newResponse ( ) { return new PutRepositoryResponse ( ) ; } @Override protected ClusterBlockException checkBlock ( PutRepositoryRequest request , ClusterState state ) { return state . blocks ( ) . globalBlockedException ( ClusterBlockLevel . METADATA_WRITE ) ; } @Override protected void masterOperation ( final PutRepositoryRequest request , ClusterState state , final ActionListener < PutRepositoryResponse > listener ) { repositoriesService . registerRepository ( new RepositoriesService . RegisterRepositoryRequest ( <str> + request . name ( ) + <str> , request . name ( ) , request . type ( ) , request . verify ( ) ) . settings ( request . settings ( ) ) . masterNodeTimeout ( request . masterNodeTimeout ( ) ) . ackTimeout ( request . timeout ( ) ) , new ActionListener < ClusterStateUpdateResponse > ( ) { @Override public void onResponse ( ClusterStateUpdateResponse response ) { listener . onResponse ( new PutRepositoryResponse ( response . isAcknowledged ( ) ) ) ; } @Override public void onFailure ( Throwable e ) { listener . onFailure ( e ) ; } } ) ; } } 
