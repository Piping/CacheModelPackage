package org . elasticsearch . index . analysis ; import org . apache . lucene . analysis . TokenStream ; import org . apache . lucene . analysis . icu . ICUFoldingFilter ; import org . elasticsearch . common . settings . Settings ; import com . ibm . icu . text . FilteredNormalizer2 ; import com . ibm . icu . text . Normalizer2 ; import com . ibm . icu . text . UnicodeSet ; import org . elasticsearch . env . Environment ; import org . elasticsearch . index . IndexSettings ; public class IcuFoldingTokenFilterFactory extends AbstractTokenFilterFactory { private final String unicodeSetFilter ; public IcuFoldingTokenFilterFactory ( IndexSettings indexSettings , Environment environment , String name , Settings settings ) { super ( indexSettings , name , settings ) ; this . unicodeSetFilter = settings . get ( <str> ) ; } @Override public TokenStream create ( TokenStream tokenStream ) { if ( unicodeSetFilter ! = null ) { Normalizer2 base = Normalizer2 . getInstance ( ICUFoldingFilter . class . getResourceAsStream ( <str> ) , <str> , Normalizer2 . Mode . COMPOSE ) ; UnicodeSet unicodeSet = new UnicodeSet ( unicodeSetFilter ) ; unicodeSet . freeze ( ) ; Normalizer2 filtered = new FilteredNormalizer2 ( base , unicodeSet ) ; return new org . apache . lucene . analysis . icu . ICUNormalizer2Filter ( tokenStream , filtered ) ; } else { return new ICUFoldingFilter ( tokenStream ) ; } } } 
