package com . badlogic . gdx . graphics . glutils ; import java . nio . ShortBuffer ; import com . badlogic . gdx . Gdx ; import com . badlogic . gdx . graphics . GL20 ; import com . badlogic . gdx . utils . BufferUtils ; import com . badlogic . gdx . utils . GdxRuntimeException ; public class IndexBufferObject implements IndexData { ShortBuffer buffer ; int bufferHandle ; final boolean isDirect ; boolean isDirty = true ; boolean isBound = false ; final int usage ; public IndexBufferObject ( boolean isStatic , int maxIndices ) { isDirect = true ; buffer = BufferUtils . newShortBuffer ( maxIndices ) ; buffer . flip ( ) ; bufferHandle = Gdx . gl20 . glGenBuffer ( ) ; usage = isStatic ? GL20 . GL_STATIC_DRAW : GL20 . GL_DYNAMIC_DRAW ; } public IndexBufferObject ( int maxIndices ) { this . isDirect = true ; buffer = BufferUtils . newShortBuffer ( maxIndices ) ; buffer . flip ( ) ; bufferHandle = Gdx . gl20 . glGenBuffer ( ) ; usage = GL20 . GL_STATIC_DRAW ; } public int getNumIndices ( ) { return buffer . limit ( ) ; } public int getNumMaxIndices ( ) { return buffer . capacity ( ) ; } public void setIndices ( short [ ] indices , int offset , int count ) { isDirty = true ; buffer . clear ( ) ; buffer . put ( indices , offset , count ) ; buffer . flip ( ) ; if ( isBound ) { Gdx . gl20 . glBufferData ( GL20 . GL_ELEMENT_ARRAY_BUFFER , buffer . limit ( ) , buffer , usage ) ; isDirty = false ; } } public void setIndices ( ShortBuffer indices ) { isDirty = true ; buffer . clear ( ) ; buffer . put ( indices ) ; buffer . flip ( ) ; if ( isBound ) { Gdx . gl20 . glBufferData ( GL20 . GL_ELEMENT_ARRAY_BUFFER , buffer . limit ( ) , buffer , usage ) ; isDirty = false ; } } public ShortBuffer getBuffer ( ) { isDirty = true ; return buffer ; } public void bind ( ) { if ( bufferHandle = = <int> ) throw new GdxRuntimeException ( <str> ) ; Gdx . gl20 . glBindBuffer ( GL20 . GL_ELEMENT_ARRAY_BUFFER , bufferHandle ) ; if ( isDirty ) { Gdx . gl20 . glBufferData ( GL20 . GL_ELEMENT_ARRAY_BUFFER , buffer . limit ( ) , buffer , usage ) ; isDirty = false ; } isBound = true ; } public void unbind ( ) { Gdx . gl20 . glBindBuffer ( GL20 . GL_ELEMENT_ARRAY_BUFFER , <int> ) ; isBound = false ; } public void invalidate ( ) { bufferHandle = Gdx . gl20 . glGenBuffer ( ) ; isDirty = true ; } public void dispose ( ) { GL20 gl = Gdx . gl20 ; gl . glBindBuffer ( GL20 . GL_ELEMENT_ARRAY_BUFFER , <int> ) ; gl . glDeleteBuffer ( bufferHandle ) ; bufferHandle = <int> ; } } 
