package io . netty . handler . codec . protobuf ; import com . google . protobuf . Message ; import com . google . protobuf . MessageLite ; import com . google . protobuf . MessageLiteOrBuilder ; import io . netty . buffer . ByteBuf ; import io . netty . channel . ChannelHandler . Sharable ; import io . netty . channel . ChannelHandlerContext ; import io . netty . channel . ChannelPipeline ; import io . netty . handler . codec . LengthFieldBasedFrameDecoder ; import io . netty . handler . codec . LengthFieldPrepender ; import io . netty . handler . codec . MessageToMessageEncoder ; import java . util . List ; import static io . netty . buffer . Unpooled . * ; @Sharable public class ProtobufEncoder extends MessageToMessageEncoder < MessageLiteOrBuilder > { @Override protected void encode ( ChannelHandlerContext ctx , MessageLiteOrBuilder msg , List < Object > out ) throws Exception { if ( msg instanceof MessageLite ) { out . add ( wrappedBuffer ( ( ( MessageLite ) msg ) . toByteArray ( ) ) ) ; return ; } if ( msg instanceof MessageLite . Builder ) { out . add ( wrappedBuffer ( ( ( MessageLite . Builder ) msg ) . build ( ) . toByteArray ( ) ) ) ; } } } 
