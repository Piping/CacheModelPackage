package com . google . common . util . concurrent ; import com . google . common . annotations . Beta ; import com . google . common . base . Supplier ; import com . google . j2objc . annotations . WeakOuter ; import java . util . concurrent . Executor ; import java . util . concurrent . TimeUnit ; import java . util . concurrent . TimeoutException ; @Beta public abstract class AbstractIdleService implements Service { private final Supplier < String > threadNameSupplier = new ThreadNameSupplier ( ) ; @WeakOuter private final class ThreadNameSupplier implements Supplier < String > { @Override public String get ( ) { return serviceName ( ) + <str> + state ( ) ; } } private final Service delegate = new DelegateService ( ) ; @WeakOuter private final class DelegateService extends AbstractService { @Override protected final void doStart ( ) { MoreExecutors . renamingDecorator ( executor ( ) , threadNameSupplier ) . execute ( new Runnable ( ) { @Override public void run ( ) { try { startUp ( ) ; notifyStarted ( ) ; } catch ( Throwable t ) { notifyFailed ( t ) ; } } } ) ; } @Override protected final void doStop ( ) { MoreExecutors . renamingDecorator ( executor ( ) , threadNameSupplier ) . execute ( new Runnable ( ) { @Override public void run ( ) { try { shutDown ( ) ; notifyStopped ( ) ; } catch ( Throwable t ) { notifyFailed ( t ) ; } } } ) ; } @Override public String toString ( ) { return AbstractIdleService . this . toString ( ) ; } } protected AbstractIdleService ( ) { } protected abstract void startUp ( ) throws Exception ; protected abstract void shutDown ( ) throws Exception ; protected Executor executor ( ) { return new Executor ( ) { @Override public void execute ( Runnable command ) { MoreExecutors . newThread ( threadNameSupplier . get ( ) , command ) . start ( ) ; } } ; } @Override public String toString ( ) { return serviceName ( ) + <str> + state ( ) + <str> ; } @Override public final boolean isRunning ( ) { return delegate . isRunning ( ) ; } @Override public final State state ( ) { return delegate . state ( ) ; } @Override public final void addListener ( Listener listener , Executor executor ) { delegate . addListener ( listener , executor ) ; } @Override public final Throwable failureCause ( ) { return delegate . failureCause ( ) ; } @Override public final Service startAsync ( ) { delegate . startAsync ( ) ; return this ; } @Override public final Service stopAsync ( ) { delegate . stopAsync ( ) ; return this ; } @Override public final void awaitRunning ( ) { delegate . awaitRunning ( ) ; } @Override public final void awaitRunning ( long timeout , TimeUnit unit ) throws TimeoutException { delegate . awaitRunning ( timeout , unit ) ; } @Override public final void awaitTerminated ( ) { delegate . awaitTerminated ( ) ; } @Override public final void awaitTerminated ( long timeout , TimeUnit unit ) throws TimeoutException { delegate . awaitTerminated ( timeout , unit ) ; } protected String serviceName ( ) { return getClass ( ) . getSimpleName ( ) ; } } 
