package org . elasticsearch . index . engine ; import org . apache . lucene . index . SegmentInfos ; import org . elasticsearch . common . io . stream . InputStreamStreamInput ; import org . elasticsearch . common . io . stream . OutputStreamStreamOutput ; import org . elasticsearch . test . ESTestCase ; import java . io . ByteArrayInputStream ; import java . io . ByteArrayOutputStream ; import java . io . IOException ; import static org . elasticsearch . test . VersionUtils . randomVersion ; public class CommitStatsTests extends ESTestCase { public void testStreamingWithNullId ( ) throws IOException { SegmentInfos segmentInfos = new SegmentInfos ( ) ; CommitStats commitStats = new CommitStats ( segmentInfos ) ; org . elasticsearch . Version targetNodeVersion = randomVersion ( random ( ) ) ; ByteArrayOutputStream outBuffer = new ByteArrayOutputStream ( ) ; OutputStreamStreamOutput out = new OutputStreamStreamOutput ( outBuffer ) ; out . setVersion ( targetNodeVersion ) ; commitStats . writeTo ( out ) ; ByteArrayInputStream inBuffer = new ByteArrayInputStream ( outBuffer . toByteArray ( ) ) ; InputStreamStreamInput in = new InputStreamStreamInput ( inBuffer ) ; in . setVersion ( targetNodeVersion ) ; CommitStats readCommitStats = CommitStats . readCommitStatsFrom ( in ) ; assertNull ( readCommitStats . getId ( ) ) ; } } 
