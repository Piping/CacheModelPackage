package io . netty . handler . ssl ; import javax . net . ssl . KeyManager ; import javax . net . ssl . KeyManagerFactory ; import javax . net . ssl . SSLContext ; import javax . net . ssl . SSLException ; import javax . net . ssl . SSLSessionContext ; import javax . net . ssl . TrustManager ; import javax . net . ssl . TrustManagerFactory ; import java . io . File ; import java . security . PrivateKey ; import java . security . cert . X509Certificate ; public final class JdkSslClientContext extends JdkSslContext { private final SSLContext ctx ; @Deprecated public JdkSslClientContext ( ) throws SSLException { this ( null , null ) ; } @Deprecated public JdkSslClientContext ( File certChainFile ) throws SSLException { this ( certChainFile , null ) ; } @Deprecated public JdkSslClientContext ( TrustManagerFactory trustManagerFactory ) throws SSLException { this ( null , trustManagerFactory ) ; } @Deprecated public JdkSslClientContext ( File certChainFile , TrustManagerFactory trustManagerFactory ) throws SSLException { this ( certChainFile , trustManagerFactory , null , IdentityCipherSuiteFilter . INSTANCE , JdkDefaultApplicationProtocolNegotiator . INSTANCE , <int> , <int> ) ; } @Deprecated public JdkSslClientContext ( File certChainFile , TrustManagerFactory trustManagerFactory , Iterable < String > ciphers , Iterable < String > nextProtocols , long sessionCacheSize , long sessionTimeout ) throws SSLException { this ( certChainFile , trustManagerFactory , ciphers , IdentityCipherSuiteFilter . INSTANCE , toNegotiator ( toApplicationProtocolConfig ( nextProtocols ) , false ) , sessionCacheSize , sessionTimeout ) ; } @Deprecated public JdkSslClientContext ( File certChainFile , TrustManagerFactory trustManagerFactory , Iterable < String > ciphers , CipherSuiteFilter cipherFilter , ApplicationProtocolConfig apn , long sessionCacheSize , long sessionTimeout ) throws SSLException { this ( certChainFile , trustManagerFactory , ciphers , cipherFilter , toNegotiator ( apn , false ) , sessionCacheSize , sessionTimeout ) ; } @Deprecated public JdkSslClientContext ( File certChainFile , TrustManagerFactory trustManagerFactory , Iterable < String > ciphers , CipherSuiteFilter cipherFilter , JdkApplicationProtocolNegotiator apn , long sessionCacheSize , long sessionTimeout ) throws SSLException { this ( certChainFile , trustManagerFactory , null , null , null , null , ciphers , cipherFilter , apn , sessionCacheSize , sessionTimeout ) ; } @Deprecated public JdkSslClientContext ( File trustCertChainFile , TrustManagerFactory trustManagerFactory , File keyCertChainFile , File keyFile , String keyPassword , KeyManagerFactory keyManagerFactory , Iterable < String > ciphers , CipherSuiteFilter cipherFilter , ApplicationProtocolConfig apn , long sessionCacheSize , long sessionTimeout ) throws SSLException { this ( trustCertChainFile , trustManagerFactory , keyCertChainFile , keyFile , keyPassword , keyManagerFactory , ciphers , cipherFilter , toNegotiator ( apn , false ) , sessionCacheSize , sessionTimeout ) ; } @Deprecated public JdkSslClientContext ( File trustCertChainFile , TrustManagerFactory trustManagerFactory , File keyCertChainFile , File keyFile , String keyPassword , KeyManagerFactory keyManagerFactory , Iterable < String > ciphers , CipherSuiteFilter cipherFilter , JdkApplicationProtocolNegotiator apn , long sessionCacheSize , long sessionTimeout ) throws SSLException { super ( ciphers , cipherFilter , apn , ClientAuth . NONE ) ; try { ctx = newSSLContext ( toX509Certificates ( trustCertChainFile ) , trustManagerFactory , toX509Certificates ( keyCertChainFile ) , toPrivateKey ( keyFile , keyPassword ) , keyPassword , keyManagerFactory , sessionCacheSize , sessionTimeout ) ; } catch ( Exception e ) { if ( e instanceof SSLException ) { throw ( SSLException ) e ; } throw new SSLException ( <str> , e ) ; } } JdkSslClientContext ( X509Certificate [ ] trustCertChain , TrustManagerFactory trustManagerFactory , X509Certificate [ ] keyCertChain , PrivateKey key , String keyPassword , KeyManagerFactory keyManagerFactory , Iterable < String > ciphers , CipherSuiteFilter cipherFilter , ApplicationProtocolConfig apn , long sessionCacheSize , long sessionTimeout ) throws SSLException { super ( ciphers , cipherFilter , toNegotiator ( apn , false ) , ClientAuth . NONE ) ; ctx = newSSLContext ( trustCertChain , trustManagerFactory , keyCertChain , key , keyPassword , keyManagerFactory , sessionCacheSize , sessionTimeout ) ; } private static SSLContext newSSLContext ( X509Certificate [ ] trustCertChain , TrustManagerFactory trustManagerFactory , X509Certificate [ ] keyCertChain , PrivateKey key , String keyPassword , KeyManagerFactory keyManagerFactory , long sessionCacheSize , long sessionTimeout ) throws SSLException { try { if ( trustCertChain ! = null ) { trustManagerFactory = buildTrustManagerFactory ( trustCertChain , trustManagerFactory ) ; } if ( keyCertChain ! = null ) { keyManagerFactory = buildKeyManagerFactory ( keyCertChain , key , keyPassword , keyManagerFactory ) ; } SSLContext ctx = SSLContext . getInstance ( PROTOCOL ) ; ctx . init ( keyManagerFactory = = null ? null : keyManagerFactory . getKeyManagers ( ) , trustManagerFactory = = null ? null : trustManagerFactory . getTrustManagers ( ) , null ) ; SSLSessionContext sessCtx = ctx . getClientSessionContext ( ) ; if ( sessionCacheSize > <int> ) { sessCtx . setSessionCacheSize ( ( int ) Math . min ( sessionCacheSize , Integer . MAX_VALUE ) ) ; } if ( sessionTimeout > <int> ) { sessCtx . setSessionTimeout ( ( int ) Math . min ( sessionTimeout , Integer . MAX_VALUE ) ) ; } return ctx ; } catch ( Exception e ) { if ( e instanceof SSLException ) { throw ( SSLException ) e ; } throw new SSLException ( <str> , e ) ; } } @Override public boolean isClient ( ) { return true ; } @Override public SSLContext context ( ) { return ctx ; } } 
