package org . elasticsearch . index . query ; import org . apache . lucene . search . Query ; import org . apache . lucene . search . spans . SpanNearQuery ; import org . apache . lucene . search . spans . SpanQuery ; import java . io . IOException ; import java . util . Iterator ; import static org . hamcrest . CoreMatchers . equalTo ; import static org . hamcrest . CoreMatchers . instanceOf ; public class SpanNearQueryBuilderTests extends AbstractQueryTestCase < SpanNearQueryBuilder > { @Override protected SpanNearQueryBuilder doCreateTestQueryBuilder ( ) { SpanTermQueryBuilder [ ] spanTermQueries = new SpanTermQueryBuilderTests ( ) . createSpanTermQueryBuilders ( randomIntBetween ( <int> , <int> ) ) ; SpanNearQueryBuilder queryBuilder = new SpanNearQueryBuilder ( spanTermQueries [ <int> ] , randomIntBetween ( - <int> , <int> ) ) ; for ( int i = <int> ; i < spanTermQueries . length ; i + + ) { queryBuilder . clause ( spanTermQueries [ i ] ) ; } queryBuilder . inOrder ( randomBoolean ( ) ) ; queryBuilder . collectPayloads ( randomBoolean ( ) ) ; return queryBuilder ; } @Override protected void doAssertLuceneQuery ( SpanNearQueryBuilder queryBuilder , Query query , QueryShardContext context ) throws IOException { assertThat ( query , instanceOf ( SpanNearQuery . class ) ) ; SpanNearQuery spanNearQuery = ( SpanNearQuery ) query ; assertThat ( spanNearQuery . getSlop ( ) , equalTo ( queryBuilder . slop ( ) ) ) ; assertThat ( spanNearQuery . isInOrder ( ) , equalTo ( queryBuilder . inOrder ( ) ) ) ; assertThat ( spanNearQuery . getClauses ( ) . length , equalTo ( queryBuilder . clauses ( ) . size ( ) ) ) ; Iterator < SpanQueryBuilder > spanQueryBuilderIterator = queryBuilder . clauses ( ) . iterator ( ) ; for ( SpanQuery spanQuery : spanNearQuery . getClauses ( ) ) { assertThat ( spanQuery , equalTo ( spanQueryBuilderIterator . next ( ) . toQuery ( context ) ) ) ; } } public void testIllegalArguments ( ) { try { new SpanNearQueryBuilder ( null , <int> ) ; fail ( <str> ) ; } catch ( IllegalArgumentException e ) { } try { SpanNearQueryBuilder spanNearQueryBuilder = new SpanNearQueryBuilder ( SpanTermQueryBuilder . PROTOTYPE , <int> ) ; spanNearQueryBuilder . clause ( null ) ; fail ( <str> ) ; } catch ( IllegalArgumentException e ) { } } public void testFromJson ( ) throws IOException { String json = <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> + <str> ; SpanNearQueryBuilder parsed = ( SpanNearQueryBuilder ) parseQuery ( json ) ; checkGeneratedJson ( json , parsed ) ; assertEquals ( json , <int> , parsed . clauses ( ) . size ( ) ) ; assertEquals ( json , <int> , parsed . slop ( ) ) ; assertEquals ( json , false , parsed . inOrder ( ) ) ; assertEquals ( json , false , parsed . collectPayloads ( ) ) ; } } 
