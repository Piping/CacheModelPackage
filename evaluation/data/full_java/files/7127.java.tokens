package org . elasticsearch . search . aggregations ; import org . elasticsearch . common . bytes . BytesReference ; import org . elasticsearch . common . io . stream . StreamInput ; import java . io . IOException ; import java . util . HashMap ; import java . util . Map ; import static java . util . Collections . emptyMap ; import static java . util . Collections . unmodifiableMap ; public class AggregationStreams { private static Map < BytesReference , Stream > streams = emptyMap ( ) ; public static interface Stream { InternalAggregation readResult ( StreamInput in ) throws IOException ; } public static synchronized void registerStream ( Stream stream , BytesReference . . . types ) { Map < BytesReference , Stream > newStreams = new HashMap < > ( streams ) ; for ( BytesReference type : types ) { newStreams . put ( type , stream ) ; } streams = unmodifiableMap ( newStreams ) ; } public static Stream stream ( BytesReference type ) { return streams . get ( type ) ; } } 
