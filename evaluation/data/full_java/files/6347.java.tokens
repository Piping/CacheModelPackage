package org . elasticsearch . index . analysis ; import org . apache . lucene . analysis . Analyzer ; import org . elasticsearch . Version ; import org . elasticsearch . common . settings . Settings ; import org . elasticsearch . env . Environment ; import org . elasticsearch . index . IndexSettings ; import org . elasticsearch . indices . analysis . AnalysisModule ; import org . elasticsearch . indices . analysis . PreBuiltAnalyzers ; import java . io . IOException ; public class PreBuiltAnalyzerProviderFactory implements AnalysisModule . AnalysisProvider < AnalyzerProvider > { private final PreBuiltAnalyzerProvider analyzerProvider ; public PreBuiltAnalyzerProviderFactory ( String name , AnalyzerScope scope , Analyzer analyzer ) { analyzerProvider = new PreBuiltAnalyzerProvider ( name , scope , analyzer ) ; } public AnalyzerProvider create ( String name , Settings settings ) { Version indexVersion = Version . indexCreated ( settings ) ; if ( ! Version . CURRENT . equals ( indexVersion ) ) { PreBuiltAnalyzers preBuiltAnalyzers = PreBuiltAnalyzers . getOrDefault ( name , null ) ; if ( preBuiltAnalyzers ! = null ) { Analyzer analyzer = preBuiltAnalyzers . getAnalyzer ( indexVersion ) ; return new PreBuiltAnalyzerProvider ( name , AnalyzerScope . INDICES , analyzer ) ; } } return analyzerProvider ; } @Override public AnalyzerProvider get ( IndexSettings indexSettings , Environment environment , String name , Settings settings ) throws IOException { return create ( name , settings ) ; } public Analyzer analyzer ( ) { return analyzerProvider . get ( ) ; } } 
