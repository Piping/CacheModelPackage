package org . elasticsearch . rest . action . admin . indices . forcemerge ; import org . elasticsearch . action . admin . indices . forcemerge . ForceMergeRequest ; import org . elasticsearch . action . admin . indices . forcemerge . ForceMergeResponse ; import org . elasticsearch . action . support . IndicesOptions ; import org . elasticsearch . client . Client ; import org . elasticsearch . common . Strings ; import org . elasticsearch . common . inject . Inject ; import org . elasticsearch . common . settings . Settings ; import org . elasticsearch . common . xcontent . XContentBuilder ; import org . elasticsearch . rest . * ; import org . elasticsearch . rest . action . support . RestBuilderListener ; import static org . elasticsearch . rest . RestRequest . Method . GET ; import static org . elasticsearch . rest . RestRequest . Method . POST ; import static org . elasticsearch . rest . RestStatus . OK ; import static org . elasticsearch . rest . action . support . RestActions . buildBroadcastShardsHeader ; public class RestForceMergeAction extends BaseRestHandler { @Inject public RestForceMergeAction ( Settings settings , RestController controller , Client client ) { super ( settings , controller , client ) ; controller . registerHandler ( POST , <str> , this ) ; controller . registerHandler ( POST , <str> , this ) ; } @Override public void handleRequest ( final RestRequest request , final RestChannel channel , final Client client ) { ForceMergeRequest mergeRequest = new ForceMergeRequest ( Strings . splitStringByCommaToArray ( request . param ( <str> ) ) ) ; mergeRequest . indicesOptions ( IndicesOptions . fromRequest ( request , mergeRequest . indicesOptions ( ) ) ) ; mergeRequest . maxNumSegments ( request . paramAsInt ( <str> , mergeRequest . maxNumSegments ( ) ) ) ; mergeRequest . onlyExpungeDeletes ( request . paramAsBoolean ( <str> , mergeRequest . onlyExpungeDeletes ( ) ) ) ; mergeRequest . flush ( request . paramAsBoolean ( <str> , mergeRequest . flush ( ) ) ) ; client . admin ( ) . indices ( ) . forceMerge ( mergeRequest , new RestBuilderListener < ForceMergeResponse > ( channel ) { @Override public RestResponse buildResponse ( ForceMergeResponse response , XContentBuilder builder ) throws Exception { builder . startObject ( ) ; buildBroadcastShardsHeader ( builder , request , response ) ; builder . endObject ( ) ; return new BytesRestResponse ( OK , builder ) ; } } ) ; } } 
