package org . gradle . logging . internal ; import org . gradle . api . Action ; import org . gradle . logging . StyledTextOutput ; import java . util . ArrayList ; import java . util . List ; public class BufferingStyledTextOutput extends AbstractStyledTextOutput { private final List < Action < StyledTextOutput > > events = new ArrayList < Action < StyledTextOutput > > ( ) ; private boolean hasContent ; public void writeTo ( StyledTextOutput output ) { for ( Action < StyledTextOutput > event : events ) { event . execute ( output ) ; } events . clear ( ) ; } @Override protected void doStyleChange ( final Style style ) { if ( ! events . isEmpty ( ) & & ( events . get ( events . size ( ) - <int> ) instanceof ChangeStyleAction ) ) { events . remove ( events . size ( ) - <int> ) ; } events . add ( new ChangeStyleAction ( style ) ) ; } @Override protected void doAppend ( final String text ) { if ( text . length ( ) = = <int> ) { return ; } hasContent = true ; events . add ( new Action < StyledTextOutput > ( ) { public void execute ( StyledTextOutput styledTextOutput ) { styledTextOutput . text ( text ) ; } } ) ; } public boolean getHasContent ( ) { return hasContent ; } private static class ChangeStyleAction implements Action < StyledTextOutput > { private final Style style ; public ChangeStyleAction ( Style style ) { this . style = style ; } public void execute ( StyledTextOutput styledTextOutput ) { styledTextOutput . style ( style ) ; } } } 
