package org . apache . cassandra . metrics ; import java . net . InetAddress ; import java . util . Map ; import java . util . UUID ; import org . junit . Test ; import com . google . common . collect . Iterators ; import org . apache . cassandra . config . DatabaseDescriptor ; import org . apache . cassandra . cql3 . UntypedResultSet ; import org . apache . cassandra . db . SystemKeyspace ; import org . apache . cassandra . db . marshal . Int32Type ; import org . apache . cassandra . db . marshal . UUIDType ; import org . apache . cassandra . hints . HintsService ; import static org . junit . Assert . assertEquals ; import static org . apache . cassandra . cql3 . QueryProcessor . executeInternal ; public class HintedHandOffMetricsTest { @Test public void testHintsMetrics ( ) throws Exception { DatabaseDescriptor . getHintsDirectory ( ) . mkdirs ( ) ; for ( int i = <int> ; i < <int> ; i + + ) HintsService . instance . metrics . incrPastWindow ( InetAddress . getLocalHost ( ) ) ; HintsService . instance . metrics . log ( ) ; UntypedResultSet rows = executeInternal ( <str> + SystemKeyspace . PEER_EVENTS ) ; Map < UUID , Integer > returned = rows . one ( ) . getMap ( <str> , UUIDType . instance , Int32Type . instance ) ; assertEquals ( Iterators . getLast ( returned . values ( ) . iterator ( ) ) . intValue ( ) , <int> ) ; } } 
