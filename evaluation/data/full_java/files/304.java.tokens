package org . apache . cassandra . db ; import org . slf4j . Logger ; import org . slf4j . LoggerFactory ; import org . apache . cassandra . config . DatabaseDescriptor ; import org . apache . cassandra . exceptions . RequestExecutionException ; import org . apache . cassandra . net . IVerbHandler ; import org . apache . cassandra . net . MessageIn ; import org . apache . cassandra . net . MessagingService ; import org . apache . cassandra . service . StorageProxy ; import org . apache . cassandra . utils . FBUtilities ; public class CounterMutationVerbHandler implements IVerbHandler < CounterMutation > { private static final Logger logger = LoggerFactory . getLogger ( CounterMutationVerbHandler . class ) ; public void doVerb ( final MessageIn < CounterMutation > message , final int id ) { final CounterMutation cm = message . payload ; logger . trace ( <str> , cm ) ; String localDataCenter = DatabaseDescriptor . getEndpointSnitch ( ) . getDatacenter ( FBUtilities . getBroadcastAddress ( ) ) ; StorageProxy . applyCounterMutationOnLeader ( cm , localDataCenter , new Runnable ( ) { public void run ( ) { MessagingService . instance ( ) . sendReply ( WriteResponse . createMessage ( ) , id , message . from ) ; } } ) ; } } 
