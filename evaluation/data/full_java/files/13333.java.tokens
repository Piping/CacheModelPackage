package org . gradle . api . publish . ivy . internal . artifact ; import org . gradle . api . Action ; import org . gradle . api . file . FileCollection ; import org . gradle . api . internal . DefaultDomainObjectSet ; import org . gradle . api . internal . file . AbstractFileCollection ; import org . gradle . internal . typeconversion . NotationParser ; import org . gradle . api . internal . tasks . AbstractTaskDependency ; import org . gradle . api . internal . tasks . TaskDependencyInternal ; import org . gradle . api . internal . tasks . TaskDependencyResolveContext ; import org . gradle . api . publish . ivy . IvyArtifact ; import org . gradle . api . publish . ivy . IvyArtifactSet ; import org . gradle . api . tasks . TaskDependency ; import java . io . File ; import java . util . LinkedHashSet ; import java . util . Set ; public class DefaultIvyArtifactSet extends DefaultDomainObjectSet < IvyArtifact > implements IvyArtifactSet { private final String publicationName ; private final TaskDependencyInternal builtBy = new ArtifactsTaskDependency ( ) ; private final ArtifactsFileCollection files = new ArtifactsFileCollection ( ) ; private final NotationParser < Object , IvyArtifact > ivyArtifactParser ; public DefaultIvyArtifactSet ( String publicationName , NotationParser < Object , IvyArtifact > ivyArtifactParser ) { super ( IvyArtifact . class ) ; this . publicationName = publicationName ; this . ivyArtifactParser = ivyArtifactParser ; } public IvyArtifact artifact ( Object source ) { IvyArtifact artifact = ivyArtifactParser . parseNotation ( source ) ; add ( artifact ) ; return artifact ; } public IvyArtifact artifact ( Object source , Action < ? super IvyArtifact > config ) { IvyArtifact artifact = artifact ( source ) ; config . execute ( artifact ) ; return artifact ; } public FileCollection getFiles ( ) { return files ; } private class ArtifactsFileCollection extends AbstractFileCollection { public String getDisplayName ( ) { return String . format ( <str> , publicationName ) ; } @Override public TaskDependency getBuildDependencies ( ) { return builtBy ; } public Set < File > getFiles ( ) { Set < File > files = new LinkedHashSet < File > ( ) ; for ( IvyArtifact artifact : DefaultIvyArtifactSet . this ) { files . add ( artifact . getFile ( ) ) ; } return files ; } } private class ArtifactsTaskDependency extends AbstractTaskDependency { @Override public void visitDependencies ( TaskDependencyResolveContext context ) { for ( IvyArtifact ivyArtifact : DefaultIvyArtifactSet . this ) { context . add ( ivyArtifact ) ; } } } } 
