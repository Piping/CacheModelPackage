package org . elasticsearch . index . analysis ; import org . elasticsearch . Version ; import org . elasticsearch . common . settings . Settings ; import org . elasticsearch . env . Environment ; import org . elasticsearch . index . IndexSettings ; import org . elasticsearch . indices . analysis . AnalysisModule ; import org . elasticsearch . indices . analysis . PreBuiltCharFilters ; import java . io . IOException ; public class PreBuiltCharFilterFactoryFactory implements AnalysisModule . AnalysisProvider < CharFilterFactory > { private final CharFilterFactory charFilterFactory ; public PreBuiltCharFilterFactoryFactory ( CharFilterFactory charFilterFactory ) { this . charFilterFactory = charFilterFactory ; } @Override public CharFilterFactory get ( IndexSettings indexSettings , Environment environment , String name , Settings settings ) throws IOException { Version indexVersion = Version . indexCreated ( settings ) ; if ( ! Version . CURRENT . equals ( indexVersion ) ) { PreBuiltCharFilters preBuiltCharFilters = PreBuiltCharFilters . getOrDefault ( name , null ) ; if ( preBuiltCharFilters ! = null ) { return preBuiltCharFilters . getCharFilterFactory ( indexVersion ) ; } } return charFilterFactory ; } } 
