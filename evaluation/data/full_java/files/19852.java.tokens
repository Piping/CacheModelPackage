package io . netty . example . memcache . binary ; import io . netty . bootstrap . Bootstrap ; import io . netty . channel . Channel ; import io . netty . channel . ChannelFuture ; import io . netty . channel . ChannelInitializer ; import io . netty . channel . ChannelPipeline ; import io . netty . channel . EventLoopGroup ; import io . netty . channel . nio . NioEventLoopGroup ; import io . netty . channel . socket . SocketChannel ; import io . netty . channel . socket . nio . NioSocketChannel ; import io . netty . handler . codec . memcache . binary . BinaryMemcacheClientCodec ; import io . netty . handler . codec . memcache . binary . BinaryMemcacheObjectAggregator ; import io . netty . handler . ssl . SslContext ; import io . netty . handler . ssl . SslContextBuilder ; import io . netty . handler . ssl . util . InsecureTrustManagerFactory ; import java . io . BufferedReader ; import java . io . InputStreamReader ; public final class MemcacheClient { static final boolean SSL = System . getProperty ( <str> ) ! = null ; static final String HOST = System . getProperty ( <str> , <str> ) ; static final int PORT = Integer . parseInt ( System . getProperty ( <str> , <str> ) ) ; public static void main ( String [ ] args ) throws Exception { final SslContext sslCtx ; if ( SSL ) { sslCtx = SslContextBuilder . forClient ( ) . trustManager ( InsecureTrustManagerFactory . INSTANCE ) . build ( ) ; } else { sslCtx = null ; } EventLoopGroup group = new NioEventLoopGroup ( ) ; try { Bootstrap b = new Bootstrap ( ) ; b . group ( group ) . channel ( NioSocketChannel . class ) . handler ( new ChannelInitializer < SocketChannel > ( ) { @Override protected void initChannel ( SocketChannel ch ) throws Exception { ChannelPipeline p = ch . pipeline ( ) ; if ( sslCtx ! = null ) { p . addLast ( sslCtx . newHandler ( ch . alloc ( ) , HOST , PORT ) ) ; } p . addLast ( new BinaryMemcacheClientCodec ( ) ) ; p . addLast ( new BinaryMemcacheObjectAggregator ( Integer . MAX_VALUE ) ) ; p . addLast ( new MemcacheClientHandler ( ) ) ; } } ) ; Channel ch = b . connect ( HOST , PORT ) . sync ( ) . channel ( ) ; System . out . println ( <str> ) ; System . out . println ( <str> ) ; System . out . println ( <str> ) ; ChannelFuture lastWriteFuture = null ; BufferedReader in = new BufferedReader ( new InputStreamReader ( System . in ) ) ; for ( ; ; ) { String line = in . readLine ( ) ; if ( line = = null ) { break ; } if ( <str> . equals ( line . toLowerCase ( ) ) ) { ch . close ( ) . sync ( ) ; break ; } lastWriteFuture = ch . writeAndFlush ( line ) ; } if ( lastWriteFuture ! = null ) { lastWriteFuture . sync ( ) ; } } finally { group . shutdownGracefully ( ) ; } } } 
