package org . elasticsearch . index . analysis ; import org . elasticsearch . Version ; import org . elasticsearch . common . settings . Settings ; import org . elasticsearch . env . Environment ; import org . elasticsearch . index . IndexSettings ; import org . elasticsearch . indices . analysis . AnalysisModule ; import org . elasticsearch . indices . analysis . PreBuiltTokenFilters ; import java . io . IOException ; public class PreBuiltTokenFilterFactoryFactory implements AnalysisModule . AnalysisProvider < TokenFilterFactory > { private final TokenFilterFactory tokenFilterFactory ; public PreBuiltTokenFilterFactoryFactory ( TokenFilterFactory tokenFilterFactory ) { this . tokenFilterFactory = tokenFilterFactory ; } @Override public TokenFilterFactory get ( IndexSettings indexSettings , Environment environment , String name , Settings settings ) throws IOException { Version indexVersion = Version . indexCreated ( settings ) ; if ( ! Version . CURRENT . equals ( indexVersion ) ) { PreBuiltTokenFilters preBuiltTokenFilters = PreBuiltTokenFilters . getOrDefault ( name , null ) ; if ( preBuiltTokenFilters ! = null ) { return preBuiltTokenFilters . getTokenFilterFactory ( indexVersion ) ; } } return tokenFilterFactory ; } } 
