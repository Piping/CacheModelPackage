package org . elasticsearch . cluster . metadata ; import org . elasticsearch . Version ; import org . elasticsearch . common . xcontent . XContentFactory ; import org . elasticsearch . common . xcontent . XContentType ; import org . elasticsearch . test . ESTestCase ; import java . io . IOException ; import static org . elasticsearch . cluster . metadata . AliasMetaData . newAliasMetaDataBuilder ; import static org . elasticsearch . common . settings . Settings . settingsBuilder ; import static org . hamcrest . Matchers . equalTo ; import static org . hamcrest . Matchers . is ; import static org . hamcrest . Matchers . nullValue ; public class ToAndFromJsonMetaDataTests extends ESTestCase { public void testSimpleJsonFromAndTo ( ) throws IOException { MetaData metaData = MetaData . builder ( ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . creationDate ( <int> ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . creationDate ( <int> ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . creationDate ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . creationDate ( <int> ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( ALIAS_FILTER1 ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( ALIAS_FILTER2 ) ) ) . put ( IndexTemplateMetaData . builder ( <str> ) . template ( <str> ) . order ( <int> ) . settings ( settingsBuilder ( ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . routing ( <str> ) ) ) . put ( IndexMetaData . builder ( <str> ) . settings ( settings ( Version . CURRENT ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . creationDate ( <int> ) . numberOfShards ( <int> ) . numberOfReplicas ( <int> ) . putMapping ( <str> , MAPPING_SOURCE1 ) . putMapping ( <str> , MAPPING_SOURCE2 ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( ALIAS_FILTER1 ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( ALIAS_FILTER2 ) ) ) . put ( IndexTemplateMetaData . builder ( <str> ) . template ( <str> ) . order ( <int> ) . settings ( settingsBuilder ( ) . put ( <str> , <str> ) . put ( <str> , <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . filter ( <str> ) ) . putAlias ( newAliasMetaDataBuilder ( <str> ) . routing ( <str> ) ) ) . build ( ) ; String metaDataSource = MetaData . Builder . toXContent ( metaData ) ; MetaData parsedMetaData = MetaData . Builder . fromXContent ( XContentFactory . xContent ( XContentType . JSON ) . createParser ( metaDataSource ) ) ; IndexMetaData indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; assertThat ( indexMetaData . getAliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; assertThat ( indexMetaData . getAliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; assertThat ( indexMetaData . getAliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( - <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; assertThat ( indexMetaData . getAliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) . string ( ) , equalTo ( ALIAS_FILTER1 ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) , nullValue ( ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) . string ( ) , equalTo ( ALIAS_FILTER2 ) ) ; indexMetaData = parsedMetaData . index ( <str> ) ; assertThat ( indexMetaData . getNumberOfShards ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getNumberOfReplicas ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getCreationDate ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . getAsMap ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getSettings ( ) . get ( <str> ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getMappings ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE1 ) ) ; assertThat ( indexMetaData . getMappings ( ) . get ( <str> ) . source ( ) . string ( ) , equalTo ( MAPPING_SOURCE2 ) ) ; assertThat ( indexMetaData . getAliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) . string ( ) , equalTo ( ALIAS_FILTER1 ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) , nullValue ( ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( indexMetaData . getAliases ( ) . get ( <str> ) . filter ( ) . string ( ) , equalTo ( ALIAS_FILTER2 ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . name ( ) , is ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . template ( ) , is ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . settings ( ) . get ( <str> ) , is ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . settings ( ) . getByPrefix ( <str> ) . get ( <str> ) , is ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . size ( ) , equalTo ( <int> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . filter ( ) . string ( ) , equalTo ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . alias ( ) , equalTo ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . indexRouting ( ) , equalTo ( <str> ) ) ; assertThat ( parsedMetaData . templates ( ) . get ( <str> ) . aliases ( ) . get ( <str> ) . searchRouting ( ) , equalTo ( <str> ) ) ; } private static final String MAPPING_SOURCE1 = <str> ; private static final String MAPPING_SOURCE2 = <str> ; private static final String ALIAS_FILTER1 = <str> ; private static final String ALIAS_FILTER2 = <str> ; } 
