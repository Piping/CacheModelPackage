package org . elasticsearch . test ; import org . apache . lucene . index . DirectoryReader ; import org . apache . lucene . index . FieldFilterLeafReader ; import org . apache . lucene . index . FilterDirectoryReader ; import org . apache . lucene . index . LeafReader ; import java . io . IOException ; import java . util . Collections ; public class FieldMaskingReader extends FilterDirectoryReader { private final String field ; public FieldMaskingReader ( String field , DirectoryReader in ) throws IOException { super ( in , new FilterDirectoryReader . SubReaderWrapper ( ) { @Override public LeafReader wrap ( LeafReader reader ) { return new FieldFilterLeafReader ( reader , Collections . singleton ( field ) , true ) ; } } ) ; this . field = field ; } @Override protected DirectoryReader doWrapDirectoryReader ( DirectoryReader in ) throws IOException { return new FieldMaskingReader ( field , in ) ; } @Override public Object getCoreCacheKey ( ) { return in . getCoreCacheKey ( ) ; } } 
