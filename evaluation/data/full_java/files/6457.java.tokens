package org . elasticsearch . index . fielddata ; import org . apache . lucene . index . BinaryDocValues ; import org . apache . lucene . util . Bits ; import org . apache . lucene . util . Bits . MatchAllBits ; import org . apache . lucene . util . BytesRef ; final class SingletonSortedBinaryDocValues extends SortedBinaryDocValues { private final BinaryDocValues in ; private final Bits docsWithField ; private BytesRef value ; private int count ; SingletonSortedBinaryDocValues ( BinaryDocValues in , Bits docsWithField ) { this . in = in ; this . docsWithField = docsWithField instanceof MatchAllBits ? null : docsWithField ; } @Override public void setDocument ( int docID ) { value = in . get ( docID ) ; if ( value . length = = <int> & & docsWithField ! = null & & ! docsWithField . get ( docID ) ) { count = <int> ; } else { count = <int> ; } } @Override public int count ( ) { return count ; } @Override public BytesRef valueAt ( int index ) { assert index = = <int> ; return value ; } public BinaryDocValues getBinaryDocValues ( ) { return in ; } public Bits getDocsWithField ( ) { return docsWithField ; } } 
