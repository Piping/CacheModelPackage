package org . apache . cassandra . db . transform ; import org . apache . cassandra . db . DeletionTime ; import org . apache . cassandra . db . partitions . PartitionIterator ; import org . apache . cassandra . db . partitions . UnfilteredPartitionIterator ; import org . apache . cassandra . db . rows . * ; public abstract class Transformation < I extends BaseRowIterator < ? > > { void attachTo ( BasePartitions partitions ) { } void attachTo ( BaseRows rows ) { } protected void onClose ( ) { } protected void onPartitionClose ( ) { } protected I applyToPartition ( I partition ) { return partition ; } protected Row applyToRow ( Row row ) { return row ; } protected RangeTombstoneMarker applyToMarker ( RangeTombstoneMarker marker ) { return marker ; } protected Row applyToStatic ( Row row ) { return row ; } protected DeletionTime applyToDeletion ( DeletionTime deletionTime ) { return deletionTime ; } public static UnfilteredPartitionIterator apply ( UnfilteredPartitionIterator iterator , Transformation < ? super UnfilteredRowIterator > transformation ) { return add ( mutable ( iterator ) , transformation ) ; } public static PartitionIterator apply ( PartitionIterator iterator , Transformation < ? super RowIterator > transformation ) { return add ( mutable ( iterator ) , transformation ) ; } public static UnfilteredRowIterator apply ( UnfilteredRowIterator iterator , Transformation < ? > transformation ) { return add ( mutable ( iterator ) , transformation ) ; } public static RowIterator apply ( RowIterator iterator , Transformation < ? > transformation ) { return add ( mutable ( iterator ) , transformation ) ; } static UnfilteredPartitions mutable ( UnfilteredPartitionIterator iterator ) { return iterator instanceof UnfilteredPartitions ? ( UnfilteredPartitions ) iterator : new UnfilteredPartitions ( iterator ) ; } static FilteredPartitions mutable ( PartitionIterator iterator ) { return iterator instanceof FilteredPartitions ? ( FilteredPartitions ) iterator : new FilteredPartitions ( iterator ) ; } static UnfilteredRows mutable ( UnfilteredRowIterator iterator ) { return iterator instanceof UnfilteredRows ? ( UnfilteredRows ) iterator : new UnfilteredRows ( iterator ) ; } static FilteredRows mutable ( RowIterator iterator ) { return iterator instanceof FilteredRows ? ( FilteredRows ) iterator : new FilteredRows ( iterator ) ; } static < E extends BaseIterator > E add ( E to , Transformation add ) { to . add ( add ) ; return to ; } static < E extends BaseIterator > E add ( E to , MoreContents add ) { to . add ( add ) ; return to ; } } 
