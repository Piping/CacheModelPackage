package org . elasticsearch . index . fielddata . fieldcomparator ; import org . apache . lucene . document . Document ; import org . apache . lucene . document . SortedDocValuesField ; import org . apache . lucene . index . * ; import org . apache . lucene . store . Directory ; import org . apache . lucene . util . BytesRef ; import org . elasticsearch . test . ESTestCase ; public class ReplaceMissingTests extends ESTestCase { public void test ( ) throws Exception { Directory dir = newDirectory ( ) ; IndexWriterConfig iwc = newIndexWriterConfig ( null ) ; iwc . setMergePolicy ( newLogMergePolicy ( ) ) ; IndexWriter iw = new IndexWriter ( dir , iwc ) ; Document doc = new Document ( ) ; doc . add ( new SortedDocValuesField ( <str> , new BytesRef ( <str> ) ) ) ; iw . addDocument ( doc ) ; doc = new Document ( ) ; iw . addDocument ( doc ) ; doc = new Document ( ) ; doc . add ( new SortedDocValuesField ( <str> , new BytesRef ( <str> ) ) ) ; iw . addDocument ( doc ) ; iw . forceMerge ( <int> ) ; iw . close ( ) ; DirectoryReader reader = DirectoryReader . open ( dir ) ; LeafReader ar = getOnlySegmentReader ( reader ) ; SortedDocValues raw = ar . getSortedDocValues ( <str> ) ; assertEquals ( <int> , raw . getValueCount ( ) ) ; SortedDocValues dv = new BytesRefFieldComparatorSource . ReplaceMissing ( raw , new BytesRef ( <str> ) ) ; assertEquals ( <int> , dv . getValueCount ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; dv = new BytesRefFieldComparatorSource . ReplaceMissing ( raw , new BytesRef ( <str> ) ) ; assertEquals ( <int> , dv . getValueCount ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; dv = new BytesRefFieldComparatorSource . ReplaceMissing ( raw , new BytesRef ( <str> ) ) ; assertEquals ( <int> , dv . getValueCount ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; dv = new BytesRefFieldComparatorSource . ReplaceMissing ( raw , new BytesRef ( <str> ) ) ; assertEquals ( <int> , dv . getValueCount ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; dv = new BytesRefFieldComparatorSource . ReplaceMissing ( raw , new BytesRef ( <str> ) ) ; assertEquals ( <int> , dv . getValueCount ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <str> , dv . lookupOrd ( <int> ) . utf8ToString ( ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; assertEquals ( <int> , dv . getOrd ( <int> ) ) ; reader . close ( ) ; dir . close ( ) ; } } 
