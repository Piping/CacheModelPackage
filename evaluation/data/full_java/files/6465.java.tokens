package org . elasticsearch . index . fielddata ; import org . apache . lucene . util . * ; import java . util . Arrays ; public abstract class SortingBinaryDocValues extends SortedBinaryDocValues { protected int count ; protected BytesRefBuilder [ ] values ; private final Sorter sorter ; protected SortingBinaryDocValues ( ) { values = new BytesRefBuilder [ ] { new BytesRefBuilder ( ) } ; sorter = new InPlaceMergeSorter ( ) { @Override protected void swap ( int i , int j ) { ArrayUtil . swap ( values , i , j ) ; } @Override protected int compare ( int i , int j ) { return values [ i ] . get ( ) . compareTo ( values [ j ] . get ( ) ) ; } } ; } protected final void grow ( ) { if ( values . length < count ) { final int oldLen = values . length ; final int newLen = ArrayUtil . oversize ( count , RamUsageEstimator . NUM_BYTES_OBJECT_REF ) ; values = Arrays . copyOf ( values , newLen ) ; for ( int i = oldLen ; i < newLen ; + + i ) { values [ i ] = new BytesRefBuilder ( ) ; } } } protected final void sort ( ) { sorter . sort ( <int> , count ) ; } @Override public final int count ( ) { return count ; } @Override public final BytesRef valueAt ( int index ) { return values [ index ] . get ( ) ; } } 
