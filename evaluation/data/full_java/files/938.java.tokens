package org . apache . cassandra . service ; import java . util . ArrayList ; import java . util . List ; import org . apache . cassandra . utils . FBUtilities ; public class ClientWarn { private static final String TRUNCATED = <str> ; private static final ThreadLocal < ClientWarn > warnLocal = new ThreadLocal < > ( ) ; private final List < String > warnings = new ArrayList < > ( ) ; private ClientWarn ( ) { } public static void warn ( String text ) { ClientWarn warner = warnLocal . get ( ) ; if ( warner ! = null ) warner . add ( text ) ; } private void add ( String warning ) { if ( warnings . size ( ) < FBUtilities . MAX_UNSIGNED_SHORT ) warnings . add ( maybeTruncate ( warning ) ) ; } private static String maybeTruncate ( String warning ) { return warning . length ( ) > FBUtilities . MAX_UNSIGNED_SHORT ? warning . substring ( <int> , FBUtilities . MAX_UNSIGNED_SHORT - TRUNCATED . length ( ) ) + TRUNCATED : warning ; } public static void captureWarnings ( ) { warnLocal . set ( new ClientWarn ( ) ) ; } public static List < String > getWarnings ( ) { ClientWarn warner = warnLocal . get ( ) ; if ( warner = = null | | warner . warnings . isEmpty ( ) ) return null ; return warner . warnings ; } public static void resetWarnings ( ) { warnLocal . remove ( ) ; } } 
