package org . gradle . performance . results ; import java . io . File ; import java . sql . Connection ; import java . sql . DriverManager ; import java . sql . SQLException ; public class H2FileDb { private final File dbFile ; private final ConnectionAction < Void > schemaInitializer ; private Connection connection ; public H2FileDb ( File dbFile , ConnectionAction < Void > schemaInitializer ) { this . dbFile = dbFile ; this . schemaInitializer = schemaInitializer ; } public void close ( ) { if ( connection ! = null ) { try { connection . close ( ) ; } catch ( SQLException e ) { throw new RuntimeException ( String . format ( <str> , dbFile ) , e ) ; } finally { connection = null ; } } } public < T > T withConnection ( ConnectionAction < T > action ) throws Exception { if ( connection = = null ) { dbFile . getParentFile ( ) . mkdirs ( ) ; Class . forName ( <str> ) ; connection = DriverManager . getConnection ( String . format ( <str> , dbFile . getAbsolutePath ( ) ) , <str> , <str> ) ; try { schemaInitializer . execute ( connection ) ; } catch ( Exception e ) { connection . close ( ) ; connection = null ; throw e ; } } return action . execute ( connection ) ; } } 
