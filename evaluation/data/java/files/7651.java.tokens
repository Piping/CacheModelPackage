package org . apache . cassandra . db . rows ; import org . apache . cassandra . utils . AbstractIterator ; import org . apache . cassandra . config . CFMetaData ; import org . apache . cassandra . db . * ; public abstract class LazilyInitializedUnfilteredRowIterator extends AbstractIterator < Unfiltered > implements UnfilteredRowIterator { private final DecoratedKey partitionKey ; private UnfilteredRowIterator iterator ; public LazilyInitializedUnfilteredRowIterator ( DecoratedKey partitionKey ) { this . partitionKey = partitionKey ; } protected abstract UnfilteredRowIterator initializeIterator ( ) ; private void maybeInit ( ) { if ( iterator = = null ) iterator = initializeIterator ( ) ; } public CFMetaData metadata ( ) { maybeInit ( ) ; return iterator . metadata ( ) ; } public PartitionColumns columns ( ) { maybeInit ( ) ; return iterator . columns ( ) ; } public boolean isReverseOrder ( ) { maybeInit ( ) ; return iterator . isReverseOrder ( ) ; } public DecoratedKey partitionKey ( ) { return partitionKey ; } public DeletionTime partitionLevelDeletion ( ) { maybeInit ( ) ; return iterator . partitionLevelDeletion ( ) ; } public Row staticRow ( ) { maybeInit ( ) ; return iterator . staticRow ( ) ; } public EncodingStats stats ( ) { maybeInit ( ) ; return iterator . stats ( ) ; } protected Unfiltered computeNext ( ) { maybeInit ( ) ; return iterator . hasNext ( ) ? iterator . next ( ) : endOfData ( ) ; } public void close ( ) { if ( iterator ! = null ) iterator . close ( ) ; } }