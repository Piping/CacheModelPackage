package org . apache . cassandra . utils ; import static org . junit . Assert . * ; import org . junit . Test ; public class NanoTimeToCurrentTimeMillisTest { @Test public void testTimestampOrdering ( ) throws Exception { long nowNanos = System . nanoTime ( ) ; long now = System . currentTimeMillis ( ) ; long lastConverted = <int> ; for ( long ii = <int> ; ii < <int> ; ii + + ) { now = Math . max ( now , System . currentTimeMillis ( ) ) ; if ( ii % <int> = = <int> ) { NanoTimeToCurrentTimeMillis . updateNow ( ) ; Thread . sleep ( <int> ) ; } nowNanos = Math . max ( nowNanos , System . nanoTime ( ) ) ; long convertedNow = NanoTimeToCurrentTimeMillis . convert ( nowNanos ) ; int maxDiff = FBUtilities . isWindows ( ) ? <int> : <int> ; assertTrue ( <str> + convertedNow + <str> + lastConverted + <str> + ii , convertedNow > = ( lastConverted - maxDiff ) ) ; maxDiff = FBUtilities . isWindows ( ) ? <int> : <int> ; assertTrue ( <str> + now + <str> + convertedNow + <str> + ii , ( maxDiff - <int> ) < = convertedNow ) ; lastConverted = convertedNow ; } } }