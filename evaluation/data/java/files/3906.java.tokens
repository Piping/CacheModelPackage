package org . nd4j . linalg . api . buffer ; import io . netty . buffer . ByteBuf ; import org . junit . Before ; import org . junit . Test ; import org . nd4j . linalg . BaseNd4jTest ; import org . nd4j . linalg . api . ndarray . INDArray ; import org . nd4j . linalg . factory . Nd4j ; import org . nd4j . linalg . factory . Nd4jBackend ; import org . nd4j . linalg . util . SerializationUtils ; import java . io . File ; import static org . junit . Assert . assertArrayEquals ; public class DoubleDataBufferTest extends BaseNd4jTest { public DoubleDataBufferTest ( Nd4jBackend backend ) { super ( backend ) ; } public DoubleDataBufferTest ( String name , Nd4jBackend backend ) { super ( name , backend ) ; } public DoubleDataBufferTest ( String name ) { super ( name ) ; } public DoubleDataBufferTest ( ) { } @Before public void before ( ) { Nd4j . dtype = DataBuffer . Type . DOUBLE ; } @Test public void testGetSet ( ) throws Exception { double [ ] d1 = new double [ ] { <int> , <int> , <int> , <int> } ; DataBuffer d = Nd4j . createBuffer ( d1 ) ; double [ ] d2 = d . asDouble ( ) ; assertArrayEquals ( d1 , d2 , <int> e - <int> f ) ; } @Test public void testAsBytes ( ) { INDArray arr = Nd4j . create ( <int> ) ; byte [ ] d = arr . data ( ) . asBytes ( ) ; assertEquals ( getFailureMessage ( ) , <int> * <int> , d . length ) ; INDArray rand = Nd4j . rand ( <int> , <int> ) ; rand . data ( ) . asBytes ( ) ; } @Test public void testSerialization ( ) { DataBuffer buf = Nd4j . createBuffer ( <int> ) ; String fileName = <str> ; File file = new File ( fileName ) ; file . deleteOnExit ( ) ; SerializationUtils . saveObject ( buf , file ) ; DataBuffer buf2 = SerializationUtils . readObject ( file ) ; assertEquals ( buf , buf2 ) ; Nd4j . alloc = DataBuffer . AllocationMode . DIRECT ; buf = Nd4j . createBuffer ( <int> ) ; file . deleteOnExit ( ) ; SerializationUtils . saveObject ( buf , file ) ; buf2 = SerializationUtils . readObject ( file ) ; assertEquals ( buf , buf2 ) ; } @Test public void testDup ( ) throws Exception { double [ ] d1 = new double [ ] { <int> , <int> , <int> , <int> } ; DataBuffer d = Nd4j . createBuffer ( d1 ) ; DataBuffer d2 = d . dup ( ) ; assertEquals ( d , d2 ) ; } @Test public void testNettyCopy ( ) { DataBuffer db = Nd4j . createBuffer ( new double [ ] { <int> , <int> , <int> , <int> } ) ; if ( db . allocationMode ( ) = = DataBuffer . AllocationMode . HEAP ) return ; ByteBuf buf = db . asNetty ( ) ; ByteBuf copy = buf . copy ( <int> , buf . capacity ( ) ) ; for ( int i = <int> ; i < db . length ( ) ; i + + ) { assertEquals ( db . getDouble ( i ) , copy . getDouble ( i * <int> ) ) ; } } @Test public void testPut ( ) throws Exception { double [ ] d1 = new double [ ] { <int> , <int> , <int> , <int> } ; DataBuffer d = Nd4j . createBuffer ( d1 ) ; d . put ( <int> , <float> ) ; double [ ] result = new double [ ] { <int> , <int> , <int> , <int> } ; d1 = d . asDouble ( ) ; assertArrayEquals ( d1 , result , <int> e - <int> f ) ; } @Test public void testGetRange ( ) throws Exception { DataBuffer buffer = Nd4j . linspace ( <int> , <int> , <int> ) . data ( ) ; double [ ] get = buffer . getDoublesAt ( <int> , <int> ) ; double [ ] data = new double [ ] { <int> , <int> , <int> } ; assertArrayEquals ( get , data , <int> e - <int> f ) ; double [ ] get2 = buffer . asDouble ( ) ; double [ ] allData = buffer . getDoublesAt ( <int> , buffer . length ( ) ) ; assertArrayEquals ( get2 , allData , <int> e - <int> f ) ; } @Test public void testGetOffsetRange ( ) throws Exception { DataBuffer buffer = Nd4j . linspace ( <int> , <int> , <int> ) . data ( ) ; double [ ] get = buffer . getDoublesAt ( <int> , <int> ) ; double [ ] data = new double [ ] { <int> , <int> , <int> } ; assertArrayEquals ( get , data , <int> e - <int> f ) ; double [ ] allButLast = new double [ ] { <int> , <int> , <int> , <int> } ; double [ ] allData = buffer . getDoublesAt ( <int> , buffer . length ( ) ) ; assertArrayEquals ( allButLast , allData , <int> e - <int> f ) ; } @Test public void testAssign ( ) { DataBuffer assertion = Nd4j . createBuffer ( new double [ ] { <int> , <int> , <int> } ) ; DataBuffer one = Nd4j . createBuffer ( new double [ ] { <int> } ) ; DataBuffer twoThree = Nd4j . createBuffer ( new double [ ] { <int> , <int> } ) ; DataBuffer blank = Nd4j . createBuffer ( new double [ ] { <int> , <int> , <int> } ) ; blank . assign ( one , twoThree ) ; assertEquals ( assertion , blank ) ; } @Override public char ordering ( ) { return <str> ; } }